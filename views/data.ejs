<!--
	Alpha by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title><%= title %></title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<style>
			tr td:last-child{
			    width:1%;
			    white-space:nowrap;
			}
			tr td:nth-last-of-type(2){
			    width:1%;
			    white-space:nowrap;
			}
		</style>
	</head>
	<body class="landing">
		<div id="page-wrapper">

			<!-- Header -->
				<% include menu %>

			<!-- Banner -->
				<section id="banner">
					<h2><%= title %></h2>
				<!--	<p>How data loop in my mind.</p> -->
					<ul class="actions">
						<li><a href="/dataloop/" class="button special anchorLink">Back</a></li>
				<!--	<li><a href="#Introduction" class="button anchorLink">Learn More</a></li>  -->
					</ul>
				</section>

			<!-- Main -->
				<section id="main" class="container">

					<section class="box">
						<h3><%= title %></h3>

						<h4>Select data repository to contribute, or create your own repository for your purpose</h4>
						<div class="table-wrapper">
							<table>

								<thead>
									<tr>
									<% columnInfos.forEach(function(colInfo) { %>
										<th><%= colInfo['Field'] %></th>
									<% }) %>
									<th></th><th></th>
									</tr>
								</thead>

								<tbody>
									<tr>
									<td>Auto ID</td>
									<% for (var i=1;i<columnInfos.length-1;i++) { %>
	                    				<td>
	                        				<input type='text' name='data[<%= columnInfos[i]['Field']%>]' 
	                                           id='<%= columnInfos[i]['Field'] %>' 
	                                           placeholder='<%= columnInfos[i]['Type']%>' />
	                    				</td>
	                				<% } %>
		                				<td><% if (locals.user) { %><%= user.name %><% } else { %>Public<% } %></td>

										<td><i class="fa fa-plus-square"></i></td>
						                <td><i class="fa fa-minus-square"></i></td>

	                				</tr>

								<% collections.forEach(function(row) { %>
									<tr>
									<% for (var key in row) { %>
										<td><%= row[key] %></td>
									<% } %>

										<td><i class="fa fa-pencil"></i></td>
						                <td><i class="fa fa-times"></i></td>

									</tr>
								<% }) %>
								</tbody>

							</table>
						</div>
					</section>
				</section>

			<!-- Footer -->
				<footer id="footer">
					<ul class="icons">
						<li><a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="#" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
						<li><a href="#" class="icon fa-instagram"><span class="label">Instagram</span></a></li>
						<li><a href="#" class="icon fa-github"><span class="label">Github</span></a></li>
						<li><a href="#" class="icon fa-dribbble"><span class="label">Dribbble</span></a></li>
						<li><a href="#" class="icon fa-google-plus"><span class="label">Google+</span></a></li>
					</ul>
					<ul class="copyright">
						<li>&copy; Untitled. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>
				</footer>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/jquery.scrollgress.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>
			<script type="text/javascript">
	            $(function(){
	                $('#add').click(function() {
	                    var data = {};
	                    <% columnInfos.forEach(function(colInfo) { %>
	                        var value = $("#<%= colInfo['Field'] %>").val()
	                        if (value == "") {
	                            alert("All data are required.");
	                            return;
	                        }
	                        data.<%= colInfo['Field'] %> = $("#<%= colInfo['Field'] %>").val();
	                    <% }) %>
	                    $.ajax({
	                        type: 'POST',
	                        data: JSON.stringify(data),
	                        contentType: 'application/json',
	                        url: 'http://localhost:3000/collection/<%= table %>',                
	                        success: function(data) {}
	                    });

	                    var newRow = '<div class="row">';
	                    for (var key in data) {
	                            newRow += '<div class="cell">' + data[key] + '</div>';
	                    }
	                    newRow += '<div class="cell icon"><i class="fa fa-pencil"></i></div><div class="cell icon"><i class="fa fa-times"></i></div> </div>';
	                    $(newRow).insertAfter("#insert");
	                    $("div.cell:first-child" ).hide();
	                    $("div.cell:nth-last-of-type(3)" ).hide();
	                });
	            })
	            $(function(){
	                $('#cancel').click(function() {
	                    $('input').val('');
	                });
	            })
	            $(function(){
	                $('#delete').click(function() {
	                    $.ajax({
	                        type: 'DELETE',
	                        data: [],
	                        contentType: 'application/json',
	                        url: 'http://localhost:3000/collection/<%= table %>',            // PROBLEM here!!!                   
	                        success: function(data) {}
	                    });
	                });
	            })
	            $(document).ready(function() {
	                $("td:first-child, th:first-child" ).hide();
	                $("td:nth-last-of-type(3), th:nth-last-of-type(3)" ).hide();
	                //$("td:last-child, th:last-child" ).hide();
	            });
	        </script>

	</body>
</html>